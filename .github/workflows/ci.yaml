---
    name: Sustainability CI
    
    on:
      pull_request:
        branches:
          - "[0-9]+.0*"
      workflow_call:
      push:
    
    jobs:
      pre-commit:
        runs-on: ubuntu-latest
        steps:
          - uses: actions/checkout@v4
          - name: Checkout repository
            uses: actions/setup-python@v4
            with:
                python-version: "3.10"
                architecture: 'x64'
          - name: Get python version
            run: echo "PY=$(python -VV | sha256sum | cut -d' ' -f1)" >> $GITHUB_ENV
          - uses: actions/cache@v1
            with:
              path: ~/.cache/pre-commit
              key: pre-commit|${{ env.PY }}|${{ hashFiles('.pre-commit-config.yaml') }}
          - name: Install pre-commit
            run: pip install pre-commit
          - name: Run pre-commit
            run: pre-commit run --all-files --show-diff-on-failure --color=always
          - name: Check that all files generated by pre-commit are in git
            run: |
              newfiles="$(git ls-files --others --exclude-from=.gitignore)"
              if [ "$newfiles" != "" ] ; then
                  echo "Please check-in the following files:"
                  echo "$newfiles"
                  exit 1
              fi
